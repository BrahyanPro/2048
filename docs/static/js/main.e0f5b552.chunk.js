(this["webpackJsonpgame-2048"]=this["webpackJsonpgame-2048"]||[]).push([[0],{16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var i,a,s,r,o=n(1),u=n(10),c=n.n(u),h=n(2),l=n(3),v=n(4),m=n(6),f=n(5),_=n(9),d=function(e){if(e>=0)return Math.random()<.1?4:2},b=n(7),g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(h.a)(this,e),this._value=t}return Object(l.a)(e,[{key:"setValue",value:function(e){this._value=e}},{key:"getValue",value:function(){return this._value}},{key:"isEmpty",value:function(){return 0===this._value}}]),e}(),p=g,j=function(e){return Math.floor(Math.random()*e)},y=function(e){for(var t=Array(e.length).fill(0),n=e.length-1,i=e.length-1;i>=0;i--)0!==e[i]&&(t[n]=e[i],n--);return t},S=function(e){for(var t=y(e),n=0,i=t.length-1;i>0;i--)t[i]===t[i-1]&&(t[i]=2*t[i],n+=t[i],t[i-1]=0);return[y(t),n]},O=function(e){for(var t=[],n=e.length,i=0;i<n;i++){t[i]=[];for(var a=n-1-i,s=0;s<n;s++)t[i][s]=e[s][a]}return t},k=function(e){for(var t=e.length,n=[],i=0;i<t;i++){n[i]=[];for(var a=0;a<t;a++){var s=t-1-a;n[i][a]=e[s][i]}}return n},x=function(e){return Array.from(e).some((function(e){return e.some((function(t,n){return n<e.length-1?t===e[n+1]:null}))}))},z="down",w="up",E="left",N="right",T="Game",V="Best",B=function(){function e(t,n){Object(h.a)(this,e),this._size=t,this._init(n)}return Object(l.a)(e,[{key:"getMatrix",value:function(){var e=this;return this._matrix.map((function(t,n){return e.getColumn(n)}))}},{key:"getColumn",value:function(e){return this._matrix[e].map((function(e){return e.getValue()}))}},{key:"setMatrix",value:function(e){if(this._size!==e.length)throw Error(i||(i=Object(b.a)(["Wrong number of columns: ",""])),e.length);for(var t=0;t<e.length;t++)if(e[t].length!==this._size)throw Error(a||(a=Object(b.a)(["Wrong number of rows in column",": ",""])),t,e[t].length);for(var n=0;n<this._matrix.length;n++)this.setColumn(n,e[n])}},{key:"setColumn",value:function(e,t){this._matrix[e].forEach((function(e,n){e.setValue(t[n])}))}},{key:"getEmptyTiles",value:function(){var e=[];return this._matrix.forEach((function(t){t.forEach((function(t){t.isEmpty()&&e.push(t)}))})),e}},{key:"hasEmptyTiles",value:function(){return this._matrix.some((function(e){return e.some((function(e){return e.isEmpty()}))}))}},{key:"hasValue",value:function(e){return this.getMatrix().some((function(t){return t.some((function(t){return t===e}))}))}},{key:"hasTilesToMerge",value:function(){return function(e){var t=O(e);return x(e)||x(t)}(this.getMatrix())}},{key:"setValueOnRandomEmptyTile",value:function(e){var t,n=this.getEmptyTiles();n[(t=n.length,Math.floor(Math.random()*Math.floor(t)))].setValue(e)}},{key:"moveTiles",value:function(e){var t=this.getMatrix(),n=[],i=0;if(e===z&&(n=t.map((function(e){var t=S(e);return i+=t[1],t[0]}))),e===w&&(n=t.map((function(e){var t=Array.from(e).reverse(),n=S(t),a=n[0];return i+=n[1],a.reverse()}))),e===N){var a=O(t).map((function(e){var t=S(e);return i+=t[1],t[0]}));n=k(a)}if(e===E){var s=k(t).map((function(e){var t=S(e);return i+=t[1],t[0]}));n=O(s)}var r,o,u=(o=n,(r=t).some((function(e,t){return e.some((function(e,n){return r[t][n]!==o[t][n]}))})));return this.setMatrix(n),{isTilesPositionChanged:u,mergedTilesSum:i}}},{key:"getSize",value:function(){return this._size}},{key:"countFilledTiles",value:function(){for(var e=0,t=0;t<this._size;t++)for(var n=0;n<this._size;n++)this._matrix[t][n].isEmpty()||e++;return e}},{key:"_getMaxTilesNumber",value:function(){return this._size*this._size}},{key:"_init",value:function(e){this._matrix=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=[],i=0;i<e;i++){n[i]=[];for(var a=0;a<t;a++)n[i][a]=new p}return n}(this._size);var t,n=0,i=e.length;if(i>this._getMaxTilesNumber())throw Error(s||(s=Object(b.a)(["Too many initial values"])));for(;n<i;){var a=(t=this._size,{x:j(t),y:j(t)}),r=a.x,o=a.y,u=this._matrix[r][o];u.isEmpty()&&(u.setValue(e[n]),n++)}}}]),e}(),M=B,C=4,G=8,P=(r={},Object(_.a)(r,C,2),Object(_.a)(r,G,4),r),R=function(){function e(t){Object(h.a)(this,e),this._start(t)}return Object(l.a)(e,[{key:"getStep",value:function(){return this._step}},{key:"getScore",value:function(){return this._score}},{key:"getNewPoints",value:function(){return this._newPoints}},{key:"hasWin",value:function(){return this._hasWin}},{key:"hasEnded",value:function(){return this._hasEnded}},{key:"setScore",value:function(e){this._score=e}},{key:"setBoardValues",value:function(e){this._board.setMatrix(e)}},{key:"getBoardValues",value:function(){return this._board.getMatrix()}},{key:"checkWin",value:function(){return this._board.hasValue(2048)}},{key:"_incScore",value:function(e){this._score+=e,this._newPoints=e}},{key:"_incStepByOne",value:function(){this._step++}},{key:"_isNextMovePossible",value:function(){return this._board.hasEmptyTiles()||this._board.hasTilesToMerge()}},{key:"move",value:function(e){if(!this._hasEnded){var t=this._board.moveTiles(e),n=t.isTilesPositionChanged,i=t.mergedTilesSum;if(n){this._incScore(i),this._hasWin||(this._hasWin=this._board.hasValue(2048)),this._incStepByOne();var a=d(this._step);this._board.setValueOnRandomEmptyTile(a),this._isNextMovePossible()||this._end()}}}},{key:"_getNumberOfTilesForInitialFill",value:function(){return this._size<=C?P[C]:P[G]}},{key:"_getInitialValuesForNonEmptyTiles",value:function(){for(var e=this._getNumberOfTilesForInitialFill(),t=[],n=0;n<e;n++)t.push(d(this._step));return t}},{key:"_initializeBoard",value:function(){var e=this._getInitialValuesForNonEmptyTiles();this._board=new M(this._size,e)}},{key:"_start",value:function(e){this._hasWin=!1,this._hasEnded=!1,this._score=0,this._newPoints=0,this._step=0,this._size=e,this._initializeBoard()}},{key:"_end",value:function(){this._hasEnded=!0}}]),e}(),F={bestScore:0,boardSize:4},L=function(){function e(t){Object(h.a)(this,e),t||(t=F),this._boardSize=t.boardSize,this._bestScore=t.bestScore,this._game=new R(this._boardSize),t.boardValues&&!t.gameEnded&&(this._game.setBoardValues(t.boardValues),this._game.setScore(t.score||0))}return Object(l.a)(e,[{key:"getBoardSize",value:function(){return this._boardSize}},{key:"getBestScore",value:function(){return this._bestScore}},{key:"getGame",value:function(){return this._game}},{key:"getSnapshot",value:function(){return{score:this._game.getScore(),bestScore:this._bestScore,boardSize:this._boardSize,boardValues:this._game.getBoardValues(),gameEnded:this._game.hasEnded()}}},{key:"_updateBestScore",value:function(){this._bestScore<this._game.getScore()&&(this._bestScore=this._game.getScore())}},{key:"_move",value:function(e){this._game.move(e),this._updateBestScore()}},{key:"moveDown",value:function(){this._move(z)}},{key:"moveUp",value:function(){this._move(w)}},{key:"moveRight",value:function(){this._move(N)}},{key:"moveLeft",value:function(){this._move(E)}},{key:"resetGame",value:function(e){this._boardSize=e,this._game=new R(this._boardSize)}}]),e}(),D=n(0),I=function(e){var t=e.value;return Object(D.jsx)("div",{className:"tile tile-".concat(t),children:Object(D.jsx)("span",{children:t})})},W=function(e){var t=e.size,n=e.matrix,i=e.actions,a=n.reduce((function(e,t){return e.concat(t)}),[]),s=Object(o.useCallback)((function(e){switch(e.preventDefault(),e.key){case"ArrowUp":i.moveUp();break;case"ArrowDown":i.moveDown();break;case"ArrowRight":i.moveRight();break;case"ArrowLeft":i.moveLeft()}}),[i]);return Object(o.useEffect)((function(){return document.addEventListener("keydown",s,!1),function(){document.removeEventListener("keydown",s,!1)}}),[i,s]),Object(D.jsx)("section",{className:"board board-".concat(t," box"),children:a.map((function(e,t){return Object(D.jsx)(I,{value:e},t)}))})},A=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(e){var i;return Object(h.a)(this,n),(i=t.call(this,e))._onSizeChange=i._onSizeChange.bind(Object(v.a)(i)),i}return Object(l.a)(n,[{key:"_onSizeChange",value:function(e){this.props.onSelect(parseInt(e.target.value,10))}},{key:"render",value:function(){return Object(D.jsxs)("div",{className:"board-size",children:[Object(D.jsx)("label",{className:"subsection-title",htmlFor:"size-select",children:"Tama\xf1o del tablero:"}),Object(D.jsxs)("select",{onChange:this._onSizeChange,value:this.props.size,name:"size",id:"size-select",className:"size-select",children:[Object(D.jsx)("option",{value:"4",children:"4 * 4"}),Object(D.jsx)("option",{value:"8",children:"8 * 8"})]})]})}}]),n}(o.PureComponent),U=function(e){var t=e.onReset;return Object(D.jsx)("button",{onClick:t,className:"new-game-button",children:"Nuevo Juego"})},J=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(e){var i;return Object(h.a)(this,n),(i=t.call(this,e)).state={size:i.props.defaultSize},i._handleSizeChange=i._handleSizeChange.bind(Object(v.a)(i)),i}return Object(l.a)(n,[{key:"_handleSizeChange",value:function(e){this.setState({size:e})}},{key:"render",value:function(){var e=this;return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(A,{size:this.state.size,onSelect:this._handleSizeChange}),Object(D.jsx)(U,{onReset:function(){return e.props.onReset(e.state.size)}})]})}}]),n}(o.PureComponent),q=function(e){var t=e.title,n=e.points,i=e.newPoints;return Object(D.jsxs)("div",{className:"box",children:[Object(D.jsxs)("h3",{className:"subsection-title",children:[t," Record: "]}),Object(D.jsxs)("p",{className:"subsection-title game-score",children:[n,i>0&&Object(D.jsx)("span",{className:"new-points",children:" + ".concat(i)},Math.random())]})]})},H=function(e){var t=e.isGameEnded,n=e.score;return t?Object(D.jsxs)("div",{className:"game-over-container",children:[Object(D.jsxs)("h3",{children:["Game finished",Object(D.jsx)("br",{}),"with the score: ",Object(D.jsx)("span",{children:n})]}),Object(D.jsx)("p",{children:"Press the button below to start a new game."})]}):null},K=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(e){var i;return Object(h.a)(this,n),(i=t.call(this,e))._app=new L(JSON.parse(localStorage.getItem("snapshot"))),i.state={score:i._app.getGame().getScore(),bestScore:i._app.getBestScore(),boardValues:i._app.getGame().getBoardValues(),boardSize:i._app.getBoardSize()},i._actions={moveUp:i._moveUp.bind(Object(v.a)(i)),moveDown:i._moveDown.bind(Object(v.a)(i)),moveRight:i._moveRight.bind(Object(v.a)(i)),moveLeft:i._moveLeft.bind(Object(v.a)(i))},i._reset=i._reset.bind(Object(v.a)(i)),i}return Object(l.a)(n,[{key:"_updateState",value:function(){this.setState({score:this._app.getGame().getScore(),bestScore:this._app.getBestScore(),boardValues:this._app.getGame().getBoardValues(),boardSize:this._app.getBoardSize()}),localStorage.setItem("snapshot",JSON.stringify(this._app.getSnapshot()))}},{key:"_moveUp",value:function(){this._app.moveUp(),this._updateState()}},{key:"_moveDown",value:function(){this._app.moveDown(),this._updateState()}},{key:"_moveRight",value:function(){this._app.moveRight(),this._updateState()}},{key:"_moveLeft",value:function(){this._app.moveLeft(),this._updateState()}},{key:"_reset",value:function(e){this._app.resetGame(e),this._updateState()}},{key:"render",value:function(){return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(H,{isGameEnded:this._app.getGame().hasEnded(),score:this.state.score}),Object(D.jsx)("section",{className:"new-game-container ".concat(this._app.getGame().hasEnded()?"game-over":""," box"),children:Object(D.jsx)(J,{defaultSize:this._app.getBoardSize(),onReset:this._reset})}),Object(D.jsxs)("section",{className:"score",children:[Object(D.jsx)(q,{title:T,points:this.state.score,newPoints:this._app.getGame().getNewPoints()}),Object(D.jsx)(q,{title:V,points:this.state.bestScore})]}),Object(D.jsx)(W,{size:this.state.boardSize,matrix:this.state.boardValues,actions:this._actions})]})}}]),n}(o.Component);n(16);c.a.render(Object(D.jsx)(K,{}),document.getElementById("game"))}},[[17,1,2]]]);
//# sourceMappingURL=main.e0f5b552.chunk.js.map